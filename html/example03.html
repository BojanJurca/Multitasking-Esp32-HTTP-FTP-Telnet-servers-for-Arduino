<html>
	Example 03 - HTML page interacting with ESP32<br><br>
	<hr />
	Led: <input type='checkbox' disabled id='ledSwitch' onClick='turnLed (this.checked)'>
	<hr />
	<script type='text/javascript'>

		// mechanism that makes REST calls and get their replies
		var httpClient = function () {
			this.request = function (url, method, callback) {
				var httpRequest = new XMLHttpRequest ();
				var httpRequestTimeout = null;
				
				httpRequest.onreadystatechange = function () {
					// console.log (httpRequest.readyState);
					if (httpRequest.readyState == 1) { // 1 = OPENED, start timing
						clearTimeout (httpRequestTimeout);
						httpRequestTimeout = setTimeout (function () { 
							alert ('Server did not reply (in time).'); 
							// errorMessage ('Server did not reply (in time).');
						}, 5000);
					}
					if (httpRequest.readyState == 4) { // 4 = DONE, call callback function with responseText
						clearTimeout (httpRequestTimeout);
						if (httpRequest.status == 200) {
							callback (httpRequest.responseText); // 200 = OK
						} else {
							alert ('Server reported error ' + httpRequest.status + ' ' + httpRequest.responseText); // some other reply status, like 404, 503, ...
							// errorMessage ('Server reported error ' + httpRequest.status + ' ' + httpRequest.responseText);
						}
					}
				}
				httpRequest.open (method, url, true);
				httpRequest.send (null);
			}
		}

		var client = new httpClient ();

		// make a REST call and initialize/populate this page
		var client = new httpClient ();
		client.request ('/builtInLed', 'GET', function (json) {
			// json reply will be in a form: {"id":"ESP32_SRV","builtInLed":"on"}
			var obj = document.getElementById ('ledSwitch'); 
			obj.disabled = false; 
			obj.checked = (JSON.parse (json).builtInLed == 'on');
		});

		function turnLed (switchIsOn) { // send desired led state to ESP and refresh ledSwitch state
			client.request (switchIsOn ? '/builtInLed/on' : '/builtInLed/off' , 'PUT', function (json) {
				var obj = document.getElementById ('ledSwitch'); 
				obj.checked = (JSON.parse (json).builtInLed == 'on');                                                           
			});
		}

	</script>
</html>
